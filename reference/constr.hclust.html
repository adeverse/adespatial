<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Space- And Time-Constrained Clustering — constr.hclust • adespatial</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Space- And Time-Constrained Clustering — constr.hclust" />
<meta property="og:description" content="Function constr.hclust carries out space-constrained or
time-constrained agglomerative clustering from a multivariate dissimilarity
matrix." />
<meta property="og:image" content="/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adespatial</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3-14</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tutorial.html">Moran's Eigenvector Maps and related methods for the spatial multiscale analysis of ecological data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sdray/adespatial/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Space- And Time-Constrained Clustering</h1>
    <small class="dont-index">Source: <a href='https://github.com/sdray/adespatial/blob/master/R/constr.hclust.R'><code>R/constr.hclust.R</code></a></small>
    <div class="hidden name"><code>constr.hclust.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function <code>constr.hclust</code> carries out space-constrained or
time-constrained agglomerative clustering from a multivariate dissimilarity
matrix.</p>
    </div>

    <pre class="usage"><span class='fu'>constr.hclust</span><span class='op'>(</span>
  <span class='va'>d</span>,
  method <span class='op'>=</span> <span class='st'>"ward.D2"</span>,
  <span class='va'>links</span>,
  <span class='va'>coords</span>,
  beta <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.25</span>,
  chron <span class='op'>=</span> <span class='cn'>FALSE</span>,
  member <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>d</th>
      <td><p>A <code><a href='https://rdrr.io/r/stats/dist.html'>dist</a>-class</code> dissimilarity (distance) matrix</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The agglomeration method to be used (default: "ward.D2"; see
details)</p></td>
    </tr>
    <tr>
      <th>links</th>
      <td><p>A list of edges (or links) connecting the points. May be omitted
in some cases; see details and examples</p></td>
    </tr>
    <tr>
      <th>coords</th>
      <td><p>Coordinates of the observations (data rows) in <code>d</code> (for
data plotting purposes; may be omitted: see details and examples)</p></td>
    </tr>
    <tr>
      <th>beta</th>
      <td><p>The beta parameter for beta-flexible clustering (default:
<code>beta = -0.25</code>)</p></td>
    </tr>
    <tr>
      <th>chron</th>
      <td><p>Logical (TRUE or FALSE) indicating whether a chronological (i.e.
time-constrained) clustering should be calculated (default:
<code>chron = FALSE</code>)</p></td>
    </tr>
    <tr>
      <th>member</th>
      <td><p>NULL or a vector with length size of <code>d</code> (default: NULL;
See details)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code><a href='constr.hclust-class.html'>constr.hclust-class</a></code> object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The agglomeration method to be used should be (an unambiguous
abbreviation of) one of <code>"ward.D"</code>,
<code>"ward.D2"</code>, <code>"single"</code>, <code>"complete"</code>,
<code>"average"</code> (UPGMA), <code>"mcquitty"</code> (WPGMA),
<code>"centroid"</code> (UPGMC), <code>"median"</code> (WPGMC), or
<code>"flexible"</code>. Method <code>"ward.D2"</code> (default) implements the
Ward (1963) clustering criterion, method
<code>"ward.D"</code> does not (Murtagh and Legendre, 2014).</p>
<p>Agglomerative clustering can be carried out with a constraint of spatial or
temporal contiguity. This means that only the objects that are linked in
<code>links</code> are considered to be candidates for clustering: the next pair of
objects to cluster will be the pair that has the lowest dissimilarity value
among the pairs that are linked.</p>
<p>The same rule applies during the subsequent clustering steps, which involve
groups of objects: the list of links is updated after each agglomeration
step. All objects that are neighbours of one of the components that have
fused are now neighbours of the newly formed cluster.</p>
<p>The edges (links) are specified using argument <code>links</code>, which can be an
object of class <code>nb</code> (see, e.g., <code><a href='https://rdrr.io/pkg/spdep/man/tri2nb.html'>tri2nb</a></code>), an object of
class <code>listw</code> (see, e.g., <code><a href='https://rdrr.io/pkg/spdep/man/nb2listw.html'>nb2listw</a></code>), a two-element
<code>list</code> or an object coercible as a such (e.g., a two-column
<code>dataframe</code>), or a two-column matrix with each row representing an edge
and the columns representing the two ends of the edges. For lists with more
than two elements, as well as dataframes or matrices with more than
two-columns only the first two elements or columns are used for the analysis.
The edges are interpreted as being non directional; there is no need to
specify an edge going from point a to point b and one going from point b to
point a. While doing so is generally inconsequential for the analysis, it
carries some penality in terms of computation time. It is a good practice to
place the nodes in increasing order of numbers from the top to the bottom and
from the left to the right of the list but this is not mandatory. A word of
caution: in cases where clusters with identical minimum distances occur, the
order of the edges in the list may have an influence on the result.
Alternative results would be statistically equivalent.</p>
<p>When argument <code>link</code> is omitted, regular (unconstrained) clustering is
performed and a <code><a href='https://rdrr.io/r/stats/hclust.html'>hclust</a>-class</code> object is returned unless
argument <code>chron = TRUE</code>. When argument <code>chron = TRUE</code>,
chronological clustring is performed, taking the order of observations as
their positions in the sequence. Argument <code>links</code> is not used when
<code>chron = TRUE</code>. Argument <code>chron</code> allows one to perform a
chronological clustring in the case where observations are ordered
chronologically. Here, the term "chronologically" should not be taken
restrictively: the method remains applicable to other sequential data sets
such as spatial series made of observations along a transect.</p>
<p>If <code>members != NULL</code>, then <code>d</code> is taken to be a dissimilarity
matrix between clusters instead of dissimilarities between singletons and
members gives the number of observations per cluster. This way the
hierarchical cluster algorithm can be ‘started in the middle of the
dendrogram’, e.g., in order to reconstruct the part of the tree above a cut
(see examples in <code><a href='https://rdrr.io/r/stats/hclust.html'>hclust</a></code> for further details on that
functionality).</p>
<p>Memory storage and time to compute constrained clustering for N objects. The
Lance and Williams algorithm for agglomerative clustering uses dissimilarity
matrices. The amount of memory needed to store the distances among N
observations as 64-bit double precision floating point variables (IEEE 754)
is 8*N*(N-1)/2 bytes. For example, a dissimilarity matrix among 22 500
observations would require 2 024 910 000 bytes (1.89 GiB) of storage whereas
one among 100 000 observations would take up 39 999 600 000 bytes
(37.25 GiB). The implementation in this function needs to cache a copy of the
dissimilarity matrix as its elements are modified following each merging of
the closest clusters or singletons, thereby doubling the amounts of required
memory shown above. Memory needed to store the other informations associated
with the clustering is much smaller. Users should make sure to have the
necessary memory space (and system stability) before attempting to analyze
large data sets. What is considered a large amount of memory has increased
over time as computer hardware evolved with time. We let users apply
contemporary common sense as to what sample sizes represent manageable
clustering problems. Computation time grows with N at roughly the same speed
as memory storage requirement to store the dissimilarity matrices increases. 
See the Benchmarking example below.</p>
<p>With large data sets, a manageable output describing the classification of
the sites is obtained with function <code><a href='https://rdrr.io/r/stats/cutree.html'>cutree</a></code>(x, k) where k is the
number of groups.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Legendre, P. and L. Legendre. 2012. Numerical ecology, 3rd English edition.
Elsevier Science BV, Amsterdam.</p>
<p>Murtagh, F. and P. Legendre. 2014. Ward’s hierarchical agglomerative
clustering method: which algorithms implement Ward’s criterion? Journal of
Classification 31: 274-295. doi: 10.1007/s00357-014-9161-z</p>
<p>Langfelder, P. and Horvath, S. 2012. Fast R Functions for Robust
Correlations and Hierarchical Clustering. Journal of Statistical Software 46:
1-17. <a href='https://www.jstatsoft.org/v46/i11/'>https://www.jstatsoft.org/v46/i11/</a></p>
<p>Ward, J. H. 1963. Hierarchical grouping to optimize an objective function.
Journal of the American Statistical Association 58: 236-244.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='plot.constr.hclust.html'>plot.constr.hclust</a></code>, <code><a href='https://rdrr.io/r/stats/hclust.html'>hclust</a></code>,
<code><a href='https://rdrr.io/r/stats/cutree.html'>cutree</a></code>, and <code><a href='ScotchWhiskey.html'>ScotchWhiskey</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Pierre Legendre <a href='mailto:pierre.legendre@umontreal.ca'>pierre.legendre@umontreal.ca</a> 
(preliminary version coded in R)
and Guillaume Guénard <a href='mailto:guillaume.guenard@umontreal.ca'>guillaume.guenard@umontreal.ca</a> 
(present version mostly coded in C)</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>##</span>
<span class='co'>### First example: Artificial map data from Legendre &amp; Legendre</span>
<span class='co'>###                (2012, Fig. 13.26): n = 16</span>
<span class='co'>##</span>
<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>41</span>,<span class='fl'>42</span>,<span class='fl'>25</span>,<span class='fl'>38</span>,<span class='fl'>50</span>,<span class='fl'>30</span>,<span class='fl'>41</span>,<span class='fl'>43</span>,<span class='fl'>43</span>,<span class='fl'>41</span>,<span class='fl'>30</span>,<span class='fl'>50</span>,<span class='fl'>38</span>,<span class='fl'>25</span>,<span class='fl'>42</span>,<span class='fl'>41</span><span class='op'>)</span>
<span class='va'>coord.dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>5</span>,<span class='fl'>7</span>,<span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>6</span>,<span class='fl'>8</span>,<span class='fl'>1</span>,<span class='fl'>3</span>,<span class='fl'>5</span>,<span class='fl'>7</span>,<span class='fl'>2</span>,<span class='fl'>4</span>,<span class='fl'>6</span>,<span class='fl'>8</span>,
                      <span class='fl'>4.4</span>,<span class='fl'>4.4</span>,<span class='fl'>4.4</span>,<span class='fl'>4.4</span>,<span class='fl'>3.3</span>,<span class='fl'>3.3</span>,<span class='fl'>3.3</span>,<span class='fl'>3.3</span>,
                      <span class='fl'>2.2</span>,<span class='fl'>2.2</span>,<span class='fl'>2.2</span>,<span class='fl'>2.2</span>,<span class='fl'>1.1</span>,<span class='fl'>1.1</span>,<span class='fl'>1.1</span>,<span class='fl'>1.1</span><span class='op'>)</span>,<span class='fl'>16</span>,<span class='fl'>2</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### Obtaining a list of neighbours:</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/r-spatial/spdep/'>spdep</a></span><span class='op'>)</span>
<span class='va'>listW</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/nb2listw.html'>nb2listw</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/spdep/man/tri2nb.html'>tri2nb</a></span><span class='op'>(</span><span class='va'>coord.dat</span><span class='op'>)</span>, style<span class='op'>=</span><span class='st'>"B"</span><span class='op'>)</span>
<span class='va'>links.mat.dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/nb2mat.html'>listw2mat</a></span><span class='op'>(</span><span class='va'>listW</span><span class='op'>)</span>
<span class='va'>neighbors</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/listw2sn.html'>listw2sn</a></span><span class='op'>(</span><span class='va'>listW</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>
<span class='co'>##</span>
<span class='co'>### Calculating the (Euclidean) distance between points:</span>
<span class='va'>D.dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/dist.html'>dist</a></span><span class='op'>(</span><span class='va'>dat</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### Display the points:</span>
<span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>coord.dat</span>, type<span class='op'>=</span><span class='st'>'n'</span>,asp<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/title.html'>title</a></span><span class='op'>(</span><span class='st'>"Delaunay triangulation"</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='va'>coord.dat</span>, labels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>dat</span><span class='op'>)</span><span class='op'>)</span>, pos<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</div><div class='input'><span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>neighbors</span><span class='op'>)</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span><span class='va'>coord.dat</span><span class='op'>[</span><span class='va'>neighbors</span><span class='op'>[</span><span class='va'>i</span>,<span class='fl'>1</span><span class='op'>]</span>,<span class='op'>]</span>,
          <span class='va'>coord.dat</span><span class='op'>[</span><span class='va'>neighbors</span><span class='op'>[</span><span class='va'>i</span>,<span class='fl'>2</span><span class='op'>]</span>,<span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>##</span>
<span class='co'>### Unconstrained clustring by hclust:</span>
<span class='va'>grpWD2_hclust</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/hclust.html'>hclust</a></span><span class='op'>(</span><span class='va'>D.dat</span>, method<span class='op'>=</span><span class='st'>"ward.D2"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grpWD2_hclust</span>, hang<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>##</span>
<span class='co'>### Clustering without a contiguity constraint;</span>
<span class='co'>### the result is represented as a dendrogram:</span>
<span class='va'>grpWD2_constr_hclust</span> <span class='op'>&lt;-</span> <span class='fu'>constr.hclust</span><span class='op'>(</span><span class='va'>D.dat</span>, method<span class='op'>=</span><span class='st'>"ward.D2"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grpWD2_constr_hclust</span>, hang<span class='op'>=</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>##</span>
<span class='co'>### Clustering with a contiguity constraint described by a list of</span>
<span class='co'>### links:</span>
<span class='va'>grpWD2cst_constr_hclust</span> <span class='op'>&lt;-</span>
    <span class='fu'>constr.hclust</span><span class='op'>(</span>
        <span class='va'>D.dat</span>, method<span class='op'>=</span><span class='st'>"ward.D2"</span>,
        <span class='va'>neighbors</span>, <span class='va'>coord.dat</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### To visualize using hclust's plotting method:</span>
<span class='co'>### stats:::plot.hclust(grpWD2cst_constr_hclust, hang=-1)</span>
<span class='co'>##</span>
<span class='co'>### Plot the results on a map with k=3 clusters:</span>
<span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grpWD2cst_constr_hclust</span>, k<span class='op'>=</span><span class='fl'>3</span>, links<span class='op'>=</span><span class='cn'>TRUE</span>, las<span class='op'>=</span><span class='fl'>1</span>, xlab<span class='op'>=</span><span class='st'>"Eastings"</span>,
     ylab<span class='op'>=</span><span class='st'>"Northings"</span>, cex<span class='op'>=</span><span class='fl'>3</span>, lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-4.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>##</span>
<span class='co'>### Generic functions from hclust can be used, for instance to obtain</span>
<span class='co'>### a list of members of each cluster:</span>
<span class='fu'><a href='https://rdrr.io/r/stats/cutree.html'>cutree</a></span><span class='op'>(</span><span class='va'>grpWD2cst_constr_hclust</span>, k<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] 1 1 2 3 1 2 3 3 1 1 2 3 1 2 3 3</div><div class='input'><span class='co'>##</span>
<span class='co'>### Now with k=5 clusters:</span>
<span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grpWD2cst_constr_hclust</span>, k<span class='op'>=</span><span class='fl'>5</span>, links<span class='op'>=</span><span class='cn'>TRUE</span>, las<span class='op'>=</span><span class='fl'>1</span>, xlab<span class='op'>=</span><span class='st'>"Eastings"</span>,
     ylab<span class='op'>=</span><span class='st'>"Northings"</span>, cex<span class='op'>=</span><span class='fl'>3</span>, lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-5.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/stats/cutree.html'>cutree</a></span><span class='op'>(</span><span class='va'>grpWD2cst_constr_hclust</span>, k<span class='op'>=</span><span class='fl'>5</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] 1 1 2 3 4 2 3 3 1 1 2 5 1 2 3 3</div><div class='input'><span class='co'>##</span>
<span class='co'>## End of the artificial map example</span>


<span class='co'>### Second example: Fish community composition along the Doubs River,</span>
<span class='co'>### France. The sequence is analyzed as a case of chronological</span>
<span class='co'>### clustering, substituting space for time.</span>
<span class='co'>##</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>doubs</span>, package<span class='op'>=</span><span class='st'>"ade4"</span><span class='op'>)</span>
<span class='va'>Doubs.D</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dist.ldc.html'>dist.ldc</a></span><span class='op'>(</span><span class='va'>doubs</span><span class='op'>$</span><span class='va'>fish</span>, method<span class='op'>=</span><span class='st'>"hellinger"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Info -- This coefficient is Euclidean</div><div class='input'><span class='va'>grpWD2cst_fish</span> <span class='op'>&lt;-</span> <span class='fu'>constr.hclust</span><span class='op'>(</span><span class='va'>Doubs.D</span>, method<span class='op'>=</span><span class='st'>"ward.D2"</span>, chron<span class='op'>=</span><span class='cn'>TRUE</span>,
                                coords<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>doubs</span><span class='op'>$</span><span class='va'>xy</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grpWD2cst_fish</span>, k<span class='op'>=</span><span class='fl'>5</span>, las<span class='op'>=</span><span class='fl'>1</span>, xlab<span class='op'>=</span><span class='st'>"Eastings (km)"</span>,
     ylab<span class='op'>=</span><span class='st'>"Northings (km)"</span>, cex<span class='op'>=</span><span class='fl'>3</span>, lwd<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-6.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>##</span>
<span class='co'>### Repeat the plot with other values of k (number of groups)</span>
<span class='co'>##</span>
<span class='co'>## End of the Doubs River fish assemblages example</span>


<span class='co'>### Third example: Scotch Whiskey distilleries clustered using tasting scores</span>
<span class='co'>### (nose, body, palate, finish, and the four distances combined) constrained</span>
<span class='co'>### with respect to the distillery locations in Scotland.</span>
<span class='co'>##</span>
<span class='co'>## Documentation file about the Scotch Whiskey data: ?ScotchWhiskey</span>
<span class='co'>##</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>ScotchWhiskey</span><span class='op'>)</span>
<span class='co'>### Cluster analyses for the nose, body, palate, and finish D</span>
<span class='co'>### matrices:</span>
<span class='va'>grpWD2cst_ScotchWhiskey</span> <span class='op'>&lt;-</span>
    <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span>
        <span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>dist</span>,    <span class='co'>## A list of distance matrices</span>
        <span class='va'>constr.hclust</span>,         <span class='co'>## The function called by function lapply</span>
        links<span class='op'>=</span><span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>neighbors</span><span class='op'>@</span><span class='va'>data</span>,         <span class='co'>## The list of links</span>
        coords<span class='op'>=</span><span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>geo</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>/</span><span class='fl'>1000</span>
    <span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### The four D matrices (nose, body, palate, finish), represented as</span>
<span class='co'>### vectors in the ScotchWiskey data file, are combined as follows to</span>
<span class='co'>### produce a single distance matrix integrating all four types of</span>
<span class='co'>### tastes:</span>
<span class='va'>Dmat</span> <span class='op'>&lt;-</span> <span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>dist</span>
<span class='va'>ScotchWhiskey</span><span class='op'>[[</span><span class='st'>"norm"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span>
    <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='va'>Dmat</span><span class='op'>$</span><span class='va'>nose</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>Dmat</span><span class='op'>$</span><span class='va'>body</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>Dmat</span><span class='op'>$</span><span class='va'>palate</span><span class='op'>^</span><span class='fl'>2</span> <span class='op'>+</span> <span class='va'>Dmat</span><span class='op'>$</span><span class='va'>finish</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### This example shows how to apply const.clust to a single D matrix when</span>
<span class='co'>### the data file contains several matrices.</span>
<span class='va'>grpWD2cst_ScotchWhiskey</span><span class='op'>[[</span><span class='st'>"norm"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span>
    <span class='fu'>constr.hclust</span><span class='op'>(</span>
        d<span class='op'>=</span><span class='va'>ScotchWhiskey</span><span class='op'>[[</span><span class='st'>"norm"</span><span class='op'>]</span><span class='op'>]</span>,method<span class='op'>=</span><span class='st'>"ward.D2"</span>,
        <span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>neighbors</span><span class='op'>@</span><span class='va'>data</span>,
        coords<span class='op'>=</span><span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>geo</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>/</span><span class='fl'>1000</span>
    <span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### A fonction to plot the Whiskey clustering results</span>
<span class='va'>plotWhiskey</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>wh</span>, <span class='va'>k</span><span class='op'>)</span> <span class='op'>{</span>
   <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>fig<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grpWD2cst_ScotchWhiskey</span><span class='op'>[[</span><span class='va'>wh</span><span class='op'>]</span><span class='op'>]</span>, k<span class='op'>=</span><span class='va'>k</span>, links<span class='op'>=</span><span class='cn'>TRUE</span>, las<span class='op'>=</span><span class='fl'>1</span>,
        xlab<span class='op'>=</span><span class='st'>"Eastings (km)"</span>, ylab<span class='op'>=</span><span class='st'>"Northings (km)"</span>, cex<span class='op'>=</span><span class='fl'>0.1</span>, lwd<span class='op'>=</span><span class='fl'>3</span>,
        main<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"Feature: %s"</span>,<span class='va'>wh</span><span class='op'>)</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>geo</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>/</span><span class='fl'>1000</span>,labels<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>geo</span><span class='op'>)</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>375</span>, y<span class='op'>=</span><span class='fl'>700</span>, lty<span class='op'>=</span><span class='fl'>1L</span>, lwd<span class='op'>=</span><span class='fl'>3</span>, col<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>rainbow</a></span><span class='op'>(</span><span class='fl'>1.2</span><span class='op'>*</span><span class='va'>k</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1L</span><span class='op'>:</span><span class='va'>k</span><span class='op'>]</span>,
          legend<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sprintf.html'>sprintf</a></span><span class='op'>(</span><span class='st'>"Group %d"</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>k</span><span class='op'>)</span>, cex<span class='op'>=</span><span class='fl'>1.25</span><span class='op'>)</span>
   <span class='va'>SpeyZoom</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>xlim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>314.7</span>,<span class='fl'>342.2</span><span class='op'>)</span>, ylim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>834.3</span>,<span class='fl'>860.0</span><span class='op'>)</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/r/graphics/rect.html'>rect</a></span><span class='op'>(</span>xleft<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>xlim</span><span class='op'>[</span><span class='fl'>1L</span><span class='op'>]</span>, ybottom<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>ylim</span><span class='op'>[</span><span class='fl'>1L</span><span class='op'>]</span>,col<span class='op'>=</span><span class='st'>"#E6E6E680"</span>,
        xright<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>xlim</span><span class='op'>[</span><span class='fl'>2L</span><span class='op'>]</span>, ytop<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>ylim</span><span class='op'>[</span><span class='fl'>2L</span><span class='op'>]</span>, lwd<span class='op'>=</span><span class='fl'>2</span>, lty<span class='op'>=</span><span class='fl'>1L</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>fig<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.01</span>,<span class='fl'>0.50</span>,<span class='fl'>0.46</span>,<span class='fl'>0.99</span><span class='op'>)</span>, new<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/pkg/adegraphics/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grpWD2cst_ScotchWhiskey</span><span class='op'>[[</span><span class='va'>wh</span><span class='op'>]</span><span class='op'>]</span>, xlim<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>xlim</span>,
        ylim<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>ylim</span>, k<span class='op'>=</span><span class='va'>k</span>, links<span class='op'>=</span><span class='cn'>TRUE</span>, las<span class='op'>=</span><span class='fl'>1</span>, xlab<span class='op'>=</span><span class='st'>""</span>, ylab<span class='op'>=</span><span class='st'>""</span>,
        cex<span class='op'>=</span><span class='fl'>0.1</span>, lwd<span class='op'>=</span><span class='fl'>3</span>, axes<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/r/graphics/text.html'>text</a></span><span class='op'>(</span><span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>geo</span><span class='op'>@</span><span class='va'>coords</span><span class='op'>/</span><span class='fl'>1000</span>,labels<span class='op'>=</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ScotchWhiskey</span><span class='op'>$</span><span class='va'>geo</span><span class='op'>)</span><span class='op'>)</span>
   <span class='fu'><a href='https://rdrr.io/r/graphics/rect.html'>rect</a></span><span class='op'>(</span>xleft<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>xlim</span><span class='op'>[</span><span class='fl'>1L</span><span class='op'>]</span>, ybottom<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>ylim</span><span class='op'>[</span><span class='fl'>1L</span><span class='op'>]</span>,
        xright<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>xlim</span><span class='op'>[</span><span class='fl'>2L</span><span class='op'>]</span>, ytop<span class='op'>=</span><span class='va'>SpeyZoom</span><span class='op'>$</span><span class='va'>ylim</span><span class='op'>[</span><span class='fl'>2L</span><span class='op'>]</span>, lwd<span class='op'>=</span><span class='fl'>2</span>, lty<span class='op'>=</span><span class='fl'>1L</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='co'>##</span>
<span class='co'>### Plot the clustering results on the map of Scotland for 5 groups.</span>
<span class='co'>### The inset map shows the Speyside distilleries in detail:</span>
<span class='fu'>plotWhiskey</span><span class='op'>(</span><span class='st'>"nose"</span>, <span class='fl'>5L</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-7.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>plotWhiskey</span><span class='op'>(</span><span class='st'>"body"</span>, <span class='fl'>5L</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-8.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>plotWhiskey</span><span class='op'>(</span><span class='st'>"palate"</span>, <span class='fl'>5L</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-9.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>plotWhiskey</span><span class='op'>(</span><span class='st'>"finish"</span>, <span class='fl'>5L</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-10.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>plotWhiskey</span><span class='op'>(</span><span class='st'>"norm"</span>, <span class='fl'>5L</span><span class='op'>)</span>
</div><div class='img'><img src='constr.hclust-11.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>##</span>
<span class='co'>## End of the Scotch Whiskey tasting data example</span>


<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'>### Benchmarking example</span>
<span class='co'>### Benchmarking can be used to estimate computation time for different</span>
<span class='co'>### values of N. </span>
<span class='co'>### Computing time grows with N at roughly the same speed as the memory</span>
<span class='co'>### storage requirements to store the dissimilarity matrices.</span>
<span class='co'>##</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://magrittr.tidyverse.org'>magrittr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'>pryr</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='va'>benchmark</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>nobj</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='co'># Argument -</span>
    <span class='co'># nobj : Number of objects in simulation runs</span>
    <span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='cn'>NA</span>,<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nobj</span><span class='op'>)</span>,<span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='va'>as.data.frame</span>
    <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>res</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"N.objects"</span>,<span class='st'>"Storage (MiB)"</span>,<span class='st'>"Time (sec)"</span><span class='op'>)</span>
    <span class='va'>res</span><span class='op'>[</span>,<span class='fl'>1L</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>nobj</span>
    <span class='co'>## resources &lt;- list()</span>
    <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nobj</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span> 
        <span class='va'>N</span> <span class='op'>&lt;-</span> <span class='va'>nobj</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>
        <span class='va'>coords.mem</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>N</span>,<span class='op'>-</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span>,y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>N</span>,<span class='op'>-</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
        <span class='va'>dat.mem</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>N</span>,<span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span>
        <span class='kw'>if</span><span class='op'>(</span><span class='va'>i</span><span class='op'>&gt;</span><span class='fl'>1L</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span><span class='op'>(</span><span class='va'>D.mem</span><span class='op'>)</span> ; <span class='fu'><a href='https://rdrr.io/r/base/gc.html'>gc</a></span><span class='op'>(</span><span class='op'>)</span>
        <span class='va'>D.mem</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='va'>dat.mem</span> <span class='op'>%&gt;%</span> <span class='va'>dist</span><span class='op'>)</span>  <span class='co'>#; gc()</span>
        <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>D.mem</span><span class='op'>)</span><span class='op'>==</span><span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span>
            <span class='kw'>break</span>
        <span class='va'>neighbors.mem</span> <span class='op'>&lt;-</span>
            <span class='op'>(</span><span class='va'>coords.mem</span> <span class='op'>%&gt;%</span>
                 <span class='va'>tri2nb</span> <span class='op'>%&gt;%</span>
                 <span class='fu'><a href='https://rdrr.io/pkg/spdep/man/nb2listw.html'>nb2listw</a></span><span class='op'>(</span>style<span class='op'>=</span><span class='st'>"B"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
                 <span class='va'>listw2sn</span><span class='op'>)</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>]</span>
        <span class='op'>{</span><span class='va'>start.time</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span>
            <span class='va'>res.mem</span> <span class='op'>&lt;-</span> <span class='kw'><a href='https://rdrr.io/r/base/try.html'>try</a></span><span class='op'>(</span><span class='fu'>constr.hclust</span><span class='op'>(</span><span class='va'>D.mem</span>, method<span class='op'>=</span><span class='st'>"ward.D2"</span>,
                                         <span class='va'>neighbors.mem</span><span class='op'>)</span><span class='op'>)</span>
            <span class='va'>end.time</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Sys.time.html'>Sys.time</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>}</span>
        <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>res.mem</span><span class='op'>)</span><span class='op'>==</span><span class='st'>"try-error"</span><span class='op'>)</span><span class='op'>)</span>
            <span class='kw'>break</span>
        <span class='va'>res</span><span class='op'>[</span><span class='va'>i</span>,<span class='fl'>2L</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='fl'>2</span><span class='op'>*</span><span class='fu'>object_size</span><span class='op'>(</span><span class='va'>D.mem</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'>object_size</span><span class='op'>(</span><span class='va'>neighbors.mem</span><span class='op'>)</span> <span class='op'>+</span>
                          <span class='fu'>object_size</span><span class='op'>(</span><span class='va'>res.mem</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>1048576</span>  <span class='co'># n. bytes per MiB</span>
        <span class='va'>res</span><span class='op'>[</span><span class='va'>i</span>,<span class='fl'>3L</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>end.time</span><span class='op'>-</span><span class='va'>start.time</span>
    <span class='op'>}</span>
    <span class='va'>res</span><span class='op'>[[</span><span class='st'>"N.objects"</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>res</span><span class='op'>[[</span><span class='st'>"N.objects"</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
    <span class='va'>res</span>
<span class='op'>}</span>
<span class='va'>res</span> <span class='op'>&lt;-</span> <span class='fu'>benchmark</span><span class='op'>(</span>nobj<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1000</span>,<span class='fl'>2000</span>,<span class='fl'>5000</span>,<span class='fl'>10000</span>,<span class='fl'>20000</span>,<span class='fl'>50000</span>,<span class='fl'>100000</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### Plotting the results:</span>
<span class='va'>ok</span> <span class='op'>&lt;-</span> <span class='va'>res</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='fl'>1L</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>!</span><span class='va'>x</span> <span class='op'>%&gt;%</span> <span class='va'>is.na</span> <span class='op'>%&gt;%</span> <span class='va'>any</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mar<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>,<span class='fl'>6</span>,<span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span>,mfrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2L</span>,<span class='fl'>1L</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/barplot.html'>barplot</a></span><span class='op'>(</span>height <span class='op'>=</span> <span class='va'>res</span><span class='op'>[</span><span class='va'>ok</span>,<span class='st'>"Time (sec)"</span><span class='op'>]</span>, names.arg<span class='op'>=</span> <span class='va'>res</span><span class='op'>[</span><span class='va'>ok</span>,<span class='st'>"N.objects"</span><span class='op'>]</span>,
        ylab<span class='op'>=</span><span class='st'>"Time (seconds)\n"</span>,xlab<span class='op'>=</span><span class='st'>""</span>,las<span class='op'>=</span><span class='fl'>1L</span>,log<span class='op'>=</span><span class='st'>"y"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mar<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fl'>6</span>,<span class='fl'>0</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/barplot.html'>barplot</a></span><span class='op'>(</span>height <span class='op'>=</span> <span class='va'>res</span><span class='op'>[</span><span class='va'>ok</span>,<span class='st'>"Storage (MiB)"</span><span class='op'>]</span>, names.arg<span class='op'>=</span> <span class='va'>res</span><span class='op'>[</span><span class='va'>ok</span>,<span class='st'>"N.objects"</span><span class='op'>]</span>,
        ylab<span class='op'>=</span><span class='st'>"Total storage (MB)\n"</span>,xlab<span class='op'>=</span><span class='st'>"Number of observations"</span>,
        las<span class='op'>=</span><span class='fl'>1L</span>,log<span class='op'>=</span><span class='st'>"y"</span><span class='op'>)</span>
<span class='co'>##</span>
<span class='co'>### Examine the output file</span>
<span class='va'>res</span>
<span class='op'>}</span>
<span class='co'>## End of the benchmarking example</span>
<span class='co'>##</span>
<span class='co'>### End of examples</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Stéphane Dray.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


