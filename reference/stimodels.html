<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Space-time interaction in ANOVA without replication — stimodels • adespatial</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Space-time interaction in ANOVA without replication — stimodels"><meta property="og:description" content="Function stimodels performs two-way ANOVA to test space-time
interaction (STI) without replicates using one among a set of possible models
described in Legendre et al. (2010).
Function quicksti allows performing space-time ANOVA in a simplified
way. In many models, degrees of freedom are saved by coding space and/or
time parsimoniously using distance-based Moran Eigenvector Maps (dbMEM;
Borcard &amp;amp; Legendre 2002; Dray et al. 2006)."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">adespatial</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3-28</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial.html">Moran's Eigenvector Maps and related methods for the spatial multiscale analysis of ecological data</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/adeverse/adespatial/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Space-time interaction in ANOVA without replication</h1>
    <small class="dont-index">Source: <a href="https://github.com/adeverse/adespatial/blob/master/R/stimodels.R" class="external-link"><code>R/stimodels.R</code></a></small>
    <div class="hidden name"><code>stimodels.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function <code>stimodels</code> performs two-way ANOVA to test space-time
interaction (STI) without replicates using one among a set of possible models
described in Legendre et al. (2010).
Function <code>quicksti</code> allows performing space-time ANOVA in a simplified
way. In many models, degrees of freedom are saved by coding space and/or
time parsimoniously using distance-based Moran Eigenvector Maps (dbMEM;
Borcard &amp; Legendre 2002; Dray et al. 2006).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stimodels</span><span class="op">(</span></span>
<span>  <span class="va">Y</span>,</span>
<span>  <span class="va">S</span>,</span>
<span>  <span class="va">Ti</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"5"</span>,</span>
<span>  nperm <span class="op">=</span> <span class="fl">999</span>,</span>
<span>  nS <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  nT <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  Sfixed <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  Tfixed <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  COD.S <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  COD.T <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save.X <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  print.res <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">quicksti</span><span class="op">(</span></span>
<span>  <span class="va">Y</span>,</span>
<span>  <span class="va">S</span>,</span>
<span>  <span class="va">Ti</span>,</span>
<span>  nperm <span class="op">=</span> <span class="fl">999</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  COD.S <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  COD.T <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  save.X <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  print.res <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Site-by-species response data table. Assumes row blocks
corresponding to times, i.e. within each block all sites are provided,
always in the same order.</p></dd>


<dt id="arg-s">S<a class="anchor" aria-label="anchor" href="#arg-s"></a></dt>
<dd><p>Number of spatial points (when they are aligned on a transect or a
time series and equispaced) or a matrix of spatial coordinates (when the
sites are on a two-dimensional surface or on a line but very irregularly
spaced).</p></dd>


<dt id="arg-ti">Ti<a class="anchor" aria-label="anchor" href="#arg-ti"></a></dt>
<dd><p>Number of time campaigns (when equispaced) or a matrix (a
vector) of temporal coordinates (when the time campaigns are very
irregularly spaced).</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Linear space-time model to be used (can be either "2", "3a",
"3b", "4", "5", "6a", "6b", or "7").</p></dd>


<dt id="arg-nperm">nperm<a class="anchor" aria-label="anchor" href="#arg-nperm"></a></dt>
<dd><p>Number of permutations in the significance tests.</p></dd>


<dt id="arg-ns">nS<a class="anchor" aria-label="anchor" href="#arg-ns"></a></dt>
<dd><p>Number of space dbMEMs to use (by default, -1, all dbMEMs with
positive autocorrelation are used).</p></dd>


<dt id="arg-nt">nT<a class="anchor" aria-label="anchor" href="#arg-nt"></a></dt>
<dd><p>Number of time dbMEMs to use (by default, -1, all dbMEMs with
positive autocorrelation are used).</p></dd>


<dt id="arg-sfixed">Sfixed<a class="anchor" aria-label="anchor" href="#arg-sfixed"></a></dt>
<dd><p>Logical: is factor Space fixed, or not (if FALSE, it is
considered a random factor).</p></dd>


<dt id="arg-tfixed">Tfixed<a class="anchor" aria-label="anchor" href="#arg-tfixed"></a></dt>
<dd><p>Logical: is factor Time fixed, or not (if FALSE, it is
considered a random factor).</p></dd>


<dt id="arg-cod-s">COD.S<a class="anchor" aria-label="anchor" href="#arg-cod-s"></a></dt>
<dd><p>Spatial coding functions to be used instead of dbMEM. The
number of columns must be lower than <code>S</code> and the number of rows must
be equal to the number of rows in <code>Y</code>. – Do not use full coding of S
(binary variables or Helmert contrasts) in COD.S to code for the factor to
be tested, space, in Model 6a: there would be no residual degrees of freedom
left for the test.</p></dd>


<dt id="arg-cod-t">COD.T<a class="anchor" aria-label="anchor" href="#arg-cod-t"></a></dt>
<dd><p>Temporal coding functions to be used instead of dbMEM. The
number of columns must be lower than <code>Ti</code> and the number of rows must
be equal to the number of rows in <code>Y</code>. – Do not use full coding of Ti
(binary variables or Helmert contrasts) in COD.T to code for the factor to
be tested, time, in Model 6b: there would be no residual degrees of freedom
left for the test.</p></dd>


<dt id="arg-save-x">save.X<a class="anchor" aria-label="anchor" href="#arg-save-x"></a></dt>
<dd><p>If TRUE, the explanatory bloc-diagonal matrix constructed for
model 6a or 6b is saved in the output list with the label X.</p></dd>


<dt id="arg-print-res">print.res<a class="anchor" aria-label="anchor" href="#arg-print-res"></a></dt>
<dd><p>If TRUE, displays the results and additional information
onscreen (recommended). If FALSE, only R2, F and P are printed onscreen.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>In <code>quicksti</code>, confidence level for the interaction test.
Depending on the decision for the interaction test, the main factors are
tested differently.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list containing the following results:</p><ul><li><p><code>testS</code> An object with the result of the space effect test, including
the mean squares for the F numerator (<code>MS.num</code>), the mean squares for
the F denominator (<code>MS.den</code>), the proportion of explained variance
(<code>R2</code>), the adjusted proportion of explained variance (<code>R2.adj</code>),
the F statistics (<code>F</code>) and its p-value computed from a permutation test
(<code>Prob</code>).</p></li>
<li><p><code>testT</code> An object with the result of the time effect test, like <code>testS</code>.</p></li>
<li><p><code>teststi</code> An object with the result of the space-time interaction test,
like <code>testS</code>.</p></li>
<li><p><code>X.matrix</code> The bloc-diagonal explanatory matrix used in test of model 6a or 6b</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>The 'stimodels' and 'quicksti' functions should only be used
(1) when each site has been sampled during each survey, with no missing data,
and (2) when there are no replicate observations of the space-time points. When
there is replication, use a regular permutational Manova function such as adonis2.</p>
<p>When the sites form a one-dimensional spatial transect, or a meandering line
such as the course of a river, with regular sampling intervals, and the time series
has fairly equal time intervals, one can use the S and Ti arguments to indicate
the number of sites in space and the number of surveys along time. The order of
the sites in each temporal block of the input data file will be taken to correspond
to the spatial positions of the sites along the transect (from 1 to S), and the
order of the time blocks in the data file will be taken to indicate the temporal
order of the surveys (from 1 to Ti). The function will then compute dbMEM
eigenfunctions corresponding to the spatial and temporal positions of the data
rows in the input data file as if they were on straight lines.</p>
<p>When the sites do not form a regular, one-dimensional spatial transect, one must
provide a file of spatial coordinates of the sites to argument S. Similarly, when
the time series has unequal time intervals, one must provide a file of temporal
coordinates of the surveys to argument Ti.</p>
<p>Alternatively, one can use arguments COD.S or COD.T to provide a matrix of Helmert
contrasts to be used in the analysis in place of dbMEM eigenfunctions. One can do
that, for example, when there are only a few surveys along time and it would not
be useful to represent these few surveys by dbMEM eigenfunctions. That matrix can
have the class "matrix" or "numeric"; they both work in functions stimodels and
quicksti. Arguments COD.S and COD.T can also be used to provide matrices
containing other types of eigenfunctions, for example AEM eigenfunctions, to be
used instead of dbMEM matrices computed by stimodels or quicksti. However, do not
code both the space and time factors as Helmert contrasts; that would not leave
residual degrees of freedom for the test of the interaction.</p>
<p>In <code>stimodels</code>, tests for space-time interaction and space or time main
effects are conducted using one of the following models:</p><ul><li><p>Model 2 - Space and Time are coded using Helmert contrasts for the main
effects. The interaction cannot be tested.</p></li>
<li><p>Model 3a - Space is coded using dbMEM variables whereas Time is coded
using Helmert contrasts.</p></li>
<li><p>Model 3b - Space is coded using Helmert contrasts whereas Time is coded
using dbMEM variables.</p></li>
<li><p>Model 4 - Both Space and Time are coded using dbMEM variables; the
interaction is coded as the Hadamard (or elementwise) product of the
space-coding by the time-coding dbMEMs.</p></li>
<li><p>Model 5 - Space and Time are coded using Helmert contrasts for the main
factor effects; the interaction is coded as the Hadamard product of the
space-coding by the time-coding dbMEM variables.</p></li>
<li><p>Model 6a - Nested model. Testing for the existence of spatial
structure (common or separate) using dbMEM (or other) variables coding for Space.</p></li>
<li><p>Model 6b - Nested model. Testing for the existence of temporal structure
(common or separate) using dbMEM (or other) variables coding for Time.</p></li>
<li><p>Model 7 - Space and Time are coded using dbMEM variables for the main
factor effects, but they are coded using Helmert contrasts for the interaction
term (not recommended).</p></li>
</ul><p>With Models 2, 6a and 6b, the interaction test is not available.</p>
<p>When using <code>quicksti</code>, space-time interaction is first tested using
Model 5. Depending on the outcome of this test, the main factors are tested
using different strategies. If the interaction is not significant then the
test of main factors is also done following Model 5. If the interaction is
significant, then a nested model (6a) is used to know whether separate
spatial structures exist and another (6b) to know whether separate temporal
structures exist. In <code>quicksti</code> function space and time are always
considered fixed factors (F ratios are constructed using residual MS in the
denominator).</p>
<p>For the interaction the permutations are unrestricted, whereas for the main
factors the permutations are restricted within time blocks (for the test of
factor Space) or space blocks (for the test of factor Time). By default, the
function computes dbMEM for space and time coding, but other space and/or
time descriptors can be provided by the user, through <code>COD.S</code> and
<code>COD.T</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Borcard, D. &amp; P. Legendre. 2002. All-scale spatial analysis of ecological data by
means of principal coordinates of neighbour matrices. Ecological Modelling 153: 51-68.
https://doi.org/10.1016/S0304-3800(01)00501-4.</p>
<p>Dray, S., P. Legendre &amp; P. R. Peres-Neto. 2006. Spatial modelling: a
comprehensive framework for principal coordinate analysis of neighbour
matrices (PCNM). Ecological Modelling 196: 483-493.
https://doi.org/10.1016/j.ecolmodel.2006.02.015.</p>
<p>Legendre, P. &amp; D. Borcard. 2018. Box-Cox-chord transformations for community
composition data prior to beta diversity analysis. Ecography 41: 1820–1824.
https://doi.org/10.1111/ecog.03498.</p>
<p>Legendre, P., M. De Caceres &amp; D. Borcard. 2010. Community surveys through space
and time: testing the space-time interaction in the absence of replication.
Ecology 91: 262-272. https://doi.org/10.1890/09-0199.1.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="trichoptera.html">trichoptera</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Pierre Legendre <a href="mailto:pierre.legendre@umontreal.ca">pierre.legendre@umontreal.ca</a>, Miquel De Caceres
and Daniel Borcard</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># The "trichoptera" data set contains the abundances of 56 Trichoptera species captured </span></span></span>
<span class="r-in"><span><span class="co"># during 100 consecutive days in 22 emergence traps along a stream. The 22 traps </span></span></span>
<span class="r-in"><span><span class="co"># (sites) form a regular transect, with geographic positions 1 to 22. The original </span></span></span>
<span class="r-in"><span><span class="co"># daily data collected at each site were pooled into 10 survey periods for the study </span></span></span>
<span class="r-in"><span><span class="co"># of Legendre et al. (2010) in order to reduce the very high proportion of zeros in the </span></span></span>
<span class="r-in"><span><span class="co"># original data matrix. Order of the observations in the data set: the 22 traps (sites) </span></span></span>
<span class="r-in"><span><span class="co"># are nested within the survey weeks, as required by the 'stimodels' and 'quicksti' </span></span></span>
<span class="r-in"><span><span class="co"># functions.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trichoptera</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># log-transform the species data, excluding the Site and Date colums</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">trich.log</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log1p</a></span><span class="op">(</span><span class="va">trichoptera</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A log-chord transformation (Legendre &amp; Borcard 2018) would also be appropriate for </span></span></span>
<span class="r-in"><span><span class="co"># these data: trich.tr &lt;- decostand(log1p(trichoptera[,-c(1,2)]), method="norm")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 1. Compute the space-time interaction test using model 5. By specifying the  </span></span></span>
<span class="r-in"><span><span class="co"># number of sites (traps), the sofware assumes that they form a regular transect with  </span></span></span>
<span class="r-in"><span><span class="co"># equispaced sites. Important note to users – In real analyses, use more than 99 </span></span></span>
<span class="r-in"><span><span class="co"># permutations.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out.1</span> <span class="op">&lt;-</span> <span class="fu">stimodels</span><span class="op">(</span><span class="va">trich.log</span>, S<span class="op">=</span><span class="fl">22</span>, Ti<span class="op">=</span><span class="fl">10</span>, model<span class="op">=</span><span class="st">"5"</span>, nperm<span class="op">=</span><span class="fl">99</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Space-time ANOVA without replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Pierre Legendre, Miquel De Caceres, Daniel Borcard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space points (s) = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time points (tt) = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of observations (n = s*tt) = 220 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of response variables (p) = 56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for space</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for space dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for time dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space coding functions = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time coding functions = 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MODEL V: HELMERT CONTRAST FOR TESTING MAIN FACTORS.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           SPACE AND TIME dbMEMs FOR TESTING INTERACTION.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of interaction variables = 40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 149 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Interaction test:   R2 = 0.1809   F = 2.9235   P( 99 perm) = 0.01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Space test:         R2 = 0.2809   F = 8.6459   P( 99 perm) = 0.01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Time test:          R2 = 0.3076   F = 22.0858   P( 99 perm) = 0.01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Time for computation = 0.813000  sec </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The interaction is significant. Because of that, test results for the main effects, </span></span></span>
<span class="r-in"><span><span class="co"># space and time, obtained with model 5, cannot be interpreted. Tests of spatial </span></span></span>
<span class="r-in"><span><span class="co"># variation can be done for individual times using simple RDA against dbMEM.S  </span></span></span>
<span class="r-in"><span><span class="co"># variables. Likewise, tests of temporal variation can be done for individual sites  </span></span></span>
<span class="r-in"><span><span class="co"># using simple RDA against dbMEM.T variables. A global test of the hypothesis that none </span></span></span>
<span class="r-in"><span><span class="co"># of the times shows a significant spatial structure can be done with model 6a. For a  </span></span></span>
<span class="r-in"><span><span class="co"># global test of temporal structure at the various sites, use model 6b.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>     <span class="co"># Code not run during CRAN software tests</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2. Run space-time analysis with global tests for main effects after testing</span></span></span>
<span class="r-in"><span><span class="co"># the interaction, which is significant in this example </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out.2</span> <span class="op">&lt;-</span> <span class="fu">quicksti</span><span class="op">(</span><span class="va">trich.log</span>, S<span class="op">=</span><span class="fl">22</span>, Ti<span class="op">=</span><span class="fl">10</span>, nperm<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Space-time ANOVA without replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Pierre Legendre, Miquel De Caceres, Daniel Borcard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space points (s) = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time points (tt) = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of observations (n = s*tt) = 220 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of response variables (p) = 56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Significance level for the interaction test (alpha) = 0.05 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for space</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for space dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for time dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space coding functions = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time coding functions = 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing space-time interaction (model 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of interaction variables = 40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 149 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Interaction test:  R2 = 0.1809   F = 2.9235   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing for separate spatial structures (model 6a)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 100 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 110 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Space test:  R2 = 0.4666   F = 2.2733   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing for separate temporal structures (model 6b)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 88 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 110 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Time test:   R2 = 0.5265   F = 3.4186   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Time for computation = 4.197000  sec </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Since the interaction is significant, function 'quicksti' will carry out the </span></span></span>
<span class="r-in"><span><span class="co"># tests of existence of a spatial (at least in one of the time periods) and temporal </span></span></span>
<span class="r-in"><span><span class="co"># (at least at one of the sites) structures using models 6a and 6b, respectively.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3. Run space-time analysis for two time blocks only, i.e. time periods 6 and 7,   </span></span></span>
<span class="r-in"><span><span class="co"># then time periods 8 and 9.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3.1. Time periods 6 and 7. The interaction is not significant. In that case,  </span></span></span>
<span class="r-in"><span><span class="co"># function 'quicksti' carries out the tests of the main effects using model 5.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out.3</span> <span class="op">&lt;-</span> <span class="fu">quicksti</span><span class="op">(</span><span class="va">trich.log</span><span class="op">[</span><span class="fl">111</span><span class="op">:</span><span class="fl">154</span>,<span class="op">]</span>, S<span class="op">=</span><span class="fl">22</span>, Ti<span class="op">=</span><span class="fl">2</span>, nperm<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Space-time ANOVA without replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Pierre Legendre, Miquel De Caceres, Daniel Borcard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space points (s) = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time points (tt) = 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of observations (n = s*tt) = 44 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of response variables (p) = 56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Significance level for the interaction test (alpha) = 0.05 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for space</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for space dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  There are only two time points. A vector of Helmert contrasts will be used to represent them</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space coding functions = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time coding functions = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing space-time interaction (model 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of interaction variables = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 11 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Interaction test:  R2 = 0.0755   F = 1.1814   P( 999 perm) = 0.248 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing for common spatial and common temporal structures (model 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Space test:   R2 = 0.8091   F = 6.026   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Time test:    R2 = 0.045   F = 7.045   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Time for computation = 0.497000  sec </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3.2. Time periods 8 and 9. The interaction is significant. In that case,  </span></span></span>
<span class="r-in"><span><span class="co"># 'quicksti' carries out the tests of the spatial effects using model 6a. Model 6b </span></span></span>
<span class="r-in"><span><span class="co"># cannot proceed with the test of the temporal effect because Ti=2. An explanation is </span></span></span>
<span class="r-in"><span><span class="co"># printed in the output list.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out.4</span> <span class="op">&lt;-</span> <span class="fu">quicksti</span><span class="op">(</span><span class="va">trich.log</span><span class="op">[</span><span class="fl">155</span><span class="op">:</span><span class="fl">198</span>,<span class="op">]</span>, S<span class="op">=</span><span class="fl">22</span>, Ti<span class="op">=</span><span class="fl">2</span>, nperm<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Space-time ANOVA without replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Pierre Legendre, Miquel De Caceres, Daniel Borcard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space points (s) = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time points (tt) = 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of observations (n = s*tt) = 44 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of response variables (p) = 56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Significance level for the interaction test (alpha) = 0.05 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for space</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for space dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  There are only two time points. A vector of Helmert contrasts will be used to represent them</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space coding functions = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time coding functions = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing space-time interaction (model 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of interaction variables = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 11 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Interaction test:  R2 = 0.1476   F = 1.5921   P( 999 perm) = 0.017 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing for separate spatial structures (model 6a)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 20 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Space test:  R2 = 0.6234   F = 2.1679   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing for separate temporal structures (model 6b)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -----------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model 6b requires that 'tt' be larger than 2. When tt=2, full coding of the times by a binary variable or Helmert contrast does not leave any degree of freedom for the residuals in the test of the Time factor.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Time for computation = 0.565000  sec </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 4. Illustrations of the use of 'COD.S' and 'COD.T' in STI analysis</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The following examples illustrate how to use other representations of the spatial or </span></span></span>
<span class="r-in"><span><span class="co"># temporal relationships among observations, through arguments 'COD.S' and </span></span></span>
<span class="r-in"><span><span class="co"># 'COD.T' of functions 'stimodels' and 'quicksti'. The trichoptera data </span></span></span>
<span class="r-in"><span><span class="co"># are used again.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 4.1. Explicitly compute dbMEMs for the spatial structure along the regular </span></span></span>
<span class="r-in"><span><span class="co"># transect, using function 'dbmem' of adespatial, and provide it to 'stimodels' </span></span></span>
<span class="r-in"><span><span class="co"># or 'quicksti' as argument 'COD.S'. The dbMEMs must first be computed on the</span></span></span>
<span class="r-in"><span><span class="co"># transect, then repeated (Ti-1) times to provide Ti repeats in total.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dbMEM.S1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="dbmem.html">dbmem</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">22</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dbMEM.S10</span> <span class="op">&lt;-</span> <span class="va">dbMEM.S1</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="va">dbMEM.S10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dbMEM.S10</span>, <span class="va">dbMEM.S1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out.5</span> <span class="op">&lt;-</span> <span class="fu">stimodels</span><span class="op">(</span><span class="va">trich.log</span>, S<span class="op">=</span><span class="fl">22</span>, Ti<span class="op">=</span><span class="fl">10</span>, model<span class="op">=</span><span class="st">"5"</span>, COD.S<span class="op">=</span><span class="va">dbMEM.S10</span>, nperm<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Space-time ANOVA without replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Pierre Legendre, Miquel De Caceres, Daniel Borcard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space points (s) = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time points (tt) = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of observations (n = s*tt) = 220 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of response variables (p) = 56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for time dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space coding functions = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time coding functions = 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MODEL V: HELMERT CONTRAST FOR TESTING MAIN FACTORS.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           SPACE AND TIME dbMEMs FOR TESTING INTERACTION.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of interaction variables = 40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 149 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Interaction test:   R2 = 0.1809   F = 2.9235   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Space test:         R2 = 0.2809   F = 8.6459   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Time test:          R2 = 0.3076   F = 22.0858   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Time for computation = 2.443000  sec </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Results should be identical to those in output file out.1 of Example 1, except for </span></span></span>
<span class="r-in"><span><span class="co"># P-values which can vary slightly.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 4.2. Assume now that the sampling sites have irregular positions, as </span></span></span>
<span class="r-in"><span><span class="co"># described by the following matrix of geographic coordinates 'xy.trich'. Provide </span></span></span>
<span class="r-in"><span><span class="co"># this matrix to argument S of 'stimodels'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xy.trich</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">11</span><span class="op">:</span><span class="fl">15</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">25</span>,<span class="fl">31</span><span class="op">:</span><span class="fl">35</span>,<span class="fl">41</span>,<span class="fl">42</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fl">11</span><span class="op">)</span><span class="op">)</span>,<span class="fl">22</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xy.trich</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span>   <span class="co"># Plot a quick map of the site positions</span></span></span>
<span class="r-plt img"><img src="stimodels-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">out.6</span> <span class="op">&lt;-</span> <span class="fu">stimodels</span><span class="op">(</span><span class="va">trich.log</span>, S<span class="op">=</span><span class="va">xy.trich</span>, Ti<span class="op">=</span><span class="fl">10</span>, model<span class="op">=</span><span class="st">"5"</span>, nperm<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Space-time ANOVA without replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Pierre Legendre, Miquel De Caceres, Daniel Borcard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space points (s) = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time points (tt) = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of observations (n = s*tt) = 220 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of response variables (p) = 56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for space</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for space dbMEMs = 6.082763 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for time dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space coding functions = 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time coding functions = 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MODEL V: HELMERT CONTRAST FOR TESTING MAIN FACTORS.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           SPACE AND TIME dbMEMs FOR TESTING INTERACTION.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of interaction variables = 16 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 173 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Interaction test:   R2 = 0.0972   F = 3.343   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Space test:         R2 = 0.2809   F = 7.3632   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Time test:          R2 = 0.3076   F = 18.8093   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Time for computation = 2.836000  sec </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 4.3. Compute a matrix of dbMEMs for the sites. The coding matrix provided to </span></span></span>
<span class="r-in"><span><span class="co"># argument 'COD.S' must contain repeated dbMEM.S codes because that matrix must have </span></span></span>
<span class="r-in"><span><span class="co"># the same number of rows as matrix Y. Construct coding matrix dbMEM.S10 containing the </span></span></span>
<span class="r-in"><span><span class="co"># dbMEM.S codes repeated 10 times. </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dbMEM.S1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="dbmem.html">dbmem</a></span><span class="op">(</span><span class="va">xy.trich</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dbMEM.S10</span> <span class="op">=</span> <span class="va">dbMEM.S1</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span> <span class="va">dbMEM.S10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dbMEM.S10</span>, <span class="va">dbMEM.S1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out.7</span> <span class="op">&lt;-</span> <span class="fu">stimodels</span><span class="op">(</span><span class="va">trich.log</span>, S<span class="op">=</span><span class="fl">22</span>, Ti<span class="op">=</span><span class="fl">10</span>, model<span class="op">=</span><span class="st">"5"</span>, COD.S<span class="op">=</span><span class="va">dbMEM.S10</span>, nperm<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Space-time ANOVA without replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Pierre Legendre, Miquel De Caceres, Daniel Borcard</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space points (s) = 22 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time points (tt) = 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of observations (n = s*tt) = 220 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of response variables (p) = 56 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Computing dbMEMs to code for time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Truncation level for time dbMEMs = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of space coding functions = 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of time coding functions = 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MODEL V: HELMERT CONTRAST FOR TESTING MAIN FACTORS.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           SPACE AND TIME dbMEMs FOR TESTING INTERACTION.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of space variables = 21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of time variables = 9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of interaction variables = 16 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Number of residual degrees of freedom = 173 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Interaction test:   R2 = 0.0972   F = 3.343   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Space test:         R2 = 0.2809   F = 7.3632   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Time test:          R2 = 0.3076   F = 18.8093   P( 999 perm) = 0.001 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -------------------------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          Time for computation = 2.822000  sec </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare the results with those obtained in the output file out6, example 4.2.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Careful: If an analysis requires a dbMEM coding matrix for 'COD.T', the dbMEM.T    </span></span></span>
<span class="r-in"><span><span class="co"># codes must follow the required data arrangement: sites must be nested within times.</span></span></span>
<span class="r-in"><span><span class="co"># The following function can be used to construct a dbMEM.T matrix.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">MEM.T</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">s</span>, <span class="va">tt</span>, <span class="va">coord.T</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Documentation of function MEM.T –</span></span></span>
<span class="r-in"><span> <span class="co"># Generate a matrix of temporal eigenfunctions for input into stimodels, </span></span></span>
<span class="r-in"><span> <span class="co"># with sites nested within times.</span></span></span>
<span class="r-in"><span> <span class="co"># Arguments –</span></span></span>
<span class="r-in"><span> <span class="co"># s : number of space points (sites)</span></span></span>
<span class="r-in"><span> <span class="co"># tt : number of time points</span></span></span>
<span class="r-in"><span> <span class="co"># coord.T : optional matrix or vector giving the time point coordinates</span></span></span>
<span class="r-in"><span>  <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">*</span><span class="va">tt</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">coord.T</span><span class="op">)</span><span class="op">)</span> <span class="va">coord.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">tt</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">MEM.TT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="dbmem.html">dbmem</a></span><span class="op">(</span><span class="va">coord.T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">dbMEM.T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">MEM.TT</span><span class="op">)</span><span class="op">)</span>    <span class="co"># Empty matrix to house dbMEM.T    </span></span></span>
<span class="r-in"><span>  <span class="va">beg.x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, by<span class="op">=</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">tt</span><span class="op">)</span> <span class="op">{</span> <span class="co"># Fill tt blocks of rows with identical MEM.TT values</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">s</span><span class="op">)</span> <span class="va">dbMEM.T</span><span class="op">[</span><span class="op">(</span><span class="va">beg.x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">j</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">MEM.TT</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">dbMEM.T</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example of use of function MEM.T</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span><span class="va">dbMEM.T</span> <span class="op">&lt;-</span> <span class="fu">MEM.T</span><span class="op">(</span>s<span class="op">=</span><span class="fl">6</span>, tt<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Check the size of the dbMEM.T output matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dbMEM.T</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 30  2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co"># End of code not run during CRAN software tests</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stéphane Dray, Aurélie Siberchicot.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

